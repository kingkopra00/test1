<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>بحث في الأدوية - مع دعم قراءة ملف Excel</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f5f7fa;
            margin: 0;
            padding: 20px;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
        }
        .upload-section {
            text-align: center;
            margin: 30px 0;
            padding: 20px;
            border: 2px dashed #3498db;
            border-radius: 8px;
            background-color: #ecf0f1;
        }
        #fileInput {
            display: none;
        }
        .upload-btn {
            background-color: #3498db;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: background-color 0.3s;
        }
        .upload-btn:hover {
            background-color: #2980b9;
        }
        .search-section {
            margin: 30px 0;
            text-align: center;
        }
        input[type="text"] {
            width: 80%;
            max-width: 500px;
            padding: 12px 20px;
            margin: 10px 0;
            display: inline-block;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        input[type="text"]:focus {
            border-color: #3498db;
            outline: none;
        }
        button {
            background-color: #3498db;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #2980b9;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-radius: 8px;
            overflow: hidden;
        }
        th, td {
            padding: 15px;
            text-align: right;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #3498db;
            color: white;
            font-weight: bold;
        }
        tr:hover {
            background-color: #f1f9ff;
        }
        .no-results {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
            font-size: 18px;
        }
        .status {
            text-align: center;
            padding: 15px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .loading {
            text-align: center;
            padding: 20px;
            font-size: 18px;
            color: #3498db;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>نظام البحث في الأدوية</h1>
        
        <div class="upload-section">
            <h3>تحميل ملف Excel</h3>
            <p>اختر ملف Excel يحتوي على بيانات الأدوية</p>
            <input type="file" id="fileInput" accept=".xlsx, .xls">
            <button class="upload-btn" onclick="document.getElementById('fileInput').click()">اختر ملف Excel</button>
            <div id="statusMessage"></div>
        </div>
        
        <div class="search-section">
            <h3>ابحث عن دواء</h3>
            <input type="text" id="searchInput" placeholder="ابحث عن اسم المستحضر التجاري أو العلمي..." onkeyup="filterTable()" disabled>
            <button onclick="clearSearch()" disabled>مسح البحث</button>
        </div>
        
        <div id="loadingIndicator" style="display: none;" class="loading">
            جاري معالجة الملف...
        </div>
        
        <table id="medicinesTable" style="display: none;">
            <thead>
                <tr>
                    <th>اسم المستحضر التجاري</th>
                    <th>اسم المستحضر العلمي</th>
                    <th>الشكل الصيدلاني</th>
                    <th>التعبئة</th>
                    <th>الشركة المصنعة</th>
                    <th>سعر بيع المكتب للمذخر</th>
                    <th>سعر بيع المذخر للصيدلية</th>
                    <th>سعر بيع الصيدلية للمواطن</th>
                </tr>
            </thead>
            <tbody id="tableBody">
            </tbody>
        </table>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        let medicinesData = [];
        
        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            
            const statusMessage = document.getElementById('statusMessage');
            const loadingIndicator = document.getElementById('loadingIndicator');
            const table = document.getElementById('medicinesTable');
            const searchInput = document.getElementById('searchInput');
            const clearButton = document.querySelector('button[onclick="clearSearch()"]');
            
            statusMessage.innerHTML = '';
            loadingIndicator.style.display = 'block';
            
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    const jsonData = XLSX.utils.sheet_to_json(firstSheet);
                    
                    if (jsonData.length === 0) {
                        throw new Error('الملف فارغ أو غير صالح');
                    }
                    
                    medicinesData = jsonData;
                    
                    // عرض الجدول وتمكين البحث
                    table.style.display = 'table';
                    searchInput.disabled = false;
                    clearButton.disabled = false;
                    
                    // عرض البيانات
                    displayMedicines(medicinesData);
                    
                    // رسالة نجاح
                    statusMessage.innerHTML = `<div class="status success">تم تحميل ${medicinesData.length} سجل بنجاح!</div>`;
                    
                } catch (error) {
                    console.error('Error:', error);
                    statusMessage.innerHTML = `<div class="status error">خطأ في قراءة الملف: ${error.message}</div>`;
                } finally {
                    loadingIndicator.style.display = 'none';
                }
            };
            
            reader.onerror = function() {
                loadingIndicator.style.display = 'none';
                statusMessage.innerHTML = `<div class="status error">حدث خطأ أثناء قراءة الملف</div>`;
            };
            
            reader.readAsArrayBuffer(file);
        });
        
        function displayMedicines(data) {
            const tableBody = document.getElementById('tableBody');
            tableBody.innerHTML = '';
            
            if (data.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="8" class="no-results">لا توجد نتائج مطابقة للبحث</td></tr>';
                return;
            }
            
            data.forEach(item => {
                const row = document.createElement('tr');
                
                // افتراض أسماء الأعمدة باللغة الإنجليزية كما هي شائعة في ملفات Excel
                // يمكنك تعديل هذه الأسماء حسب ما يظهر في ملف Excel الخاص بك
                row.innerHTML = `
                    <td>${item['اسم المستحضر التجاري'] || item['Commercial Name'] || '-'}</td>
                    <td>${item['اسم المستحضر العلمي'] || item['Scientific Name'] || '-'}</td>
                    <td>${item['الشكل الصيدلاني'] || item['Pharmaceutical Form'] || '-'}</td>
                    <td>${item['التعبئة'] || item['Packaging'] || '-'}</td>
                    <td>${item['الشركة المصنعة'] || item['Manufacturer'] || '-'}</td>
                    <td>${item['سعر بيع المكتب للمذخر'] || item['Office to Warehouse Price'] || '-'}</td>
                    <td>${item['سعر بيع المذخر للصيدلية'] || item['Warehouse to Pharmacy Price'] || '-'}</td>
                    <td>${item['سعر بيع الصيدلية للمواطن'] || item['Pharmacy to Citizen Price'] || '-'}</td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        function filterTable() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const filteredData = medicinesData.filter(item => {
                return (
                    (item['اسم المستحضر التجاري'] && item['اسم المستحضر التجاري'].toString().toLowerCase().includes(searchTerm)) ||
                    (item['اسم المستحضر العلمي'] && item['اسم المستحضر العلمي'].toString().toLowerCase().includes(searchTerm)) ||
                    (item['الشركة المصنعة'] && item['الشركة المصنعة'].toString().toLowerCase().includes(searchTerm)) ||
                    (item['Commercial Name'] && item['Commercial Name'].toString().toLowerCase().includes(searchTerm)) ||
                    (item['Scientific Name'] && item['Scientific Name'].toString().toLowerCase().includes(searchTerm)) ||
                    (item['Manufacturer'] && item['Manufacturer'].toString().toLowerCase().includes(searchTerm))
                );
            });
            displayMedicines(filteredData);
        }
        
        function clearSearch() {
            document.getElementById('searchInput').value = '';
            displayMedicines(medicinesData);
        }
    </script>
</body>
</html>