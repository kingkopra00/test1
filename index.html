<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø§Ù„Ø¯ÙˆØ§Ø¦ÙŠ Ø§Ù„Ø°ÙƒÙŠ (Offline)</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary: #2563eb;
            --bg: #f8fafc;
            --text: #1e293b;
            --font: 'Cairo', sans-serif;
            --shadow: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
        }

        body { font-family: var(--font); background-color: var(--bg); color: var(--text); margin: 0; padding: 20px; }
        .container { max-width: 1000px; margin: 0 auto; }

        /* --- Header --- */
        .header-card {
            background: white; padding: 20px; border-radius: 16px;
            box-shadow: var(--shadow); margin-bottom: 25px; text-align: center; border: 1px solid #e2e8f0;
        }

        .db-status {
            background: #f1f5f9; color: #64748b; display: inline-block;
            padding: 5px 15px; border-radius: 20px; font-size: 0.85rem; margin-top: 10px; font-weight: 600;
        }

        .btn { padding: 10px 20px; border-radius: 8px; border: none; font-family: var(--font); font-weight: 700; cursor: pointer; margin: 5px; transition: 0.2s; }
        .btn:hover { transform: translateY(-2px); }
        .btn-upload { background: var(--primary); color: white; }
        .btn-github { background: #0f172a; color: white; }
        .btn-clear { background: #ef4444; color: white; }

        /* --- Search Area --- */
        .search-area { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .input-wrapper { position: relative; }
        .input-wrapper label { display: block; margin-bottom: 8px; font-weight: 700; color: #64748b; font-size: 0.9rem; }
        .input-wrapper input { width: 100%; padding: 14px 16px; border: 2px solid #e2e8f0; border-radius: 12px; font-family: var(--font); font-size: 1rem; box-sizing: border-box; transition: 0.3s; background: white; }
        .input-wrapper input:focus { border-color: var(--primary); outline: none; box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1); }

        /* --- Suggestions --- */
        .suggestions-list { position: absolute; top: 100%; left: 0; right: 0; background: white; border: 1px solid #e2e8f0; border-radius: 12px; margin-top: 5px; max-height: 350px; overflow-y: auto; z-index: 1000; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1); display: none; }
        .suggestion-item { padding: 12px 16px; cursor: pointer; border-bottom: 1px solid #f1f5f9; transition: 0.2s; }
        .suggestion-item:hover { background-color: #eff6ff; }
        .sugg-main { font-weight: 800; font-size: 1.1rem; color: var(--primary); margin-bottom: 2px; }
        .sugg-sub { color: #64748b; font-size: 0.85rem; }

        /* --- Results --- */
        .drug-card { background: white; border-radius: 20px; box-shadow: var(--shadow); padding: 40px; border-top: 6px solid var(--primary); animation: slideUp 0.4s ease-out; text-align: center; }
        .drug-card h2 { margin: 10px 0; color: #1e293b; font-size: 2.2rem; }
        .drug-card h3 { margin: 0 0 20px 0; color: #64748b; font-weight: 400; font-size: 1.1rem; }
        .company-badge { background: #f1f5f9; padding: 6px 16px; border-radius: 30px; color: #475569; font-weight: 700; font-size: 0.9rem; display: inline-block; }

        .prices-grid { display: flex; justify-content: center; gap: 30px; margin-top: 40px; flex-wrap: wrap; }
        .price-box { background: #f8fafc; padding: 20px 30px; border-radius: 16px; min-width: 160px; border: 1px solid #e2e8f0; }
        .price-box label { display: block; color: #64748b; font-size: 0.9rem; margin-bottom: 8px; font-weight: 600; }
        .price-box .value { font-size: 1.8rem; font-weight: 800; font-family: 'Segoe UI', sans-serif; direction: ltr; }
        .price-phar { border-bottom: 4px solid var(--primary); } .price-phar .value { color: var(--primary); }
        .price-pub { border-bottom: 4px solid #dc2626; } .price-pub .value { color: #dc2626; }

        /* --- Table --- */
        .company-header { background: white; padding: 20px; border-radius: 12px 12px 0 0; border-bottom: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center; }
        .table-wrapper { background: white; border-radius: 12px; box-shadow: var(--shadow); overflow: hidden; }
        table { width: 100%; border-collapse: collapse; }
        th { background: #f8fafc; padding: 15px; text-align: right; color: #475569; font-weight: 700; font-size: 0.9rem; }
        td { padding: 12px 15px; border-bottom: 1px solid #e2e8f0; cursor: pointer; }
        tr:hover { background: #f1f5f9; }

        .loader { display: none; margin: 10px auto; width: 30px; height: 30px; border: 3px solid #e2e8f0; border-top: 3px solid var(--primary); border-radius: 50%; animation: spin 1s infinite; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div class="container">
        <div class="header-card">
            <h1 style="color: var(--primary); margin:0;">ğŸ’Š Ø§Ù„Ù…Ø³ØªØ¹Ù„Ù… Ø§Ù„Ø¯ÙˆØ§Ø¦ÙŠ Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ</h1>
            <div id="dbStatus" class="db-status">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>
            
            <div style="margin-top: 20px;">
                <button class="btn btn-upload" onclick="document.getElementById('fileInput').click()">ğŸ“‚ Ø±ÙØ¹ Ù…Ù„Ù Excel</button>
                <button class="btn btn-github" onclick="loadFromGithub()">ğŸŒ ØªØ­Ø¯ÙŠØ« Ù…Ù† GitHub</button>
                <button class="btn btn-clear" onclick="clearAllData()">ğŸ—‘ï¸ Ù…Ø³Ø­ Ø§Ù„Ø°Ø§ÙƒØ±Ø©</button>
            </div>
            
            <input type="file" id="fileInput" accept=".xlsx" style="display: none;" onchange="handleFileUpload(this)">
            <div class="loader" id="loader"></div>
            <div id="statusMsg" style="margin-top: 10px; font-weight:600; font-size:0.9rem;"></div>
        </div>

        <div class="search-area">
            <div class="input-wrapper">
                <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ØªØ¬Ø§Ø±ÙŠ (Commercial)</label>
                <input type="text" id="inpComm" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø§Ø³Ù… Ø§Ù„ØªØ¬Ø§Ø±ÙŠ..." oninput="handleSearch('commercial', this.value)" autocomplete="off">
                <div id="listComm" class="suggestions-list"></div>
            </div>
            <div class="input-wrapper">
                <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¹Ù„Ù…ÙŠ (Scientific)</label>
                <input type="text" id="inpSci" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ù…Ø§Ø¯Ø© Ø§Ù„Ø¹Ù„Ù…ÙŠØ©..." oninput="handleSearch('scientific', this.value)" autocomplete="off">
                <div id="listSci" class="suggestions-list"></div>
            </div>
            <div class="input-wrapper">
                <label>Ø§Ù„Ø´Ø±ÙƒØ© Ø§Ù„Ù…ØµÙ†Ø¹Ø© (Company)</label>
                <input type="text" id="inpComp" placeholder="Ø§Ø®ØªØ± Ø§Ù„Ø´Ø±ÙƒØ©..." oninput="handleSearch('company', this.value)" autocomplete="off">
                <div id="listComp" class="suggestions-list"></div>
            </div>
        </div>

        <div id="resultContainer"></div>
    </div>

    <script>
        // --- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù… ---
        let medicinesData = [];
        let columnMapping = {};
        const GITHUB_URL = "https://raw.githubusercontent.com/kingkopra00/find-drug/main/price-list.xlsx";
        const DB_NAME = "PharmaSystemDB";
        const DB_VERSION = 1;
        const STORE_NAME = "MedicinesStore";

        // --- Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¹Ø§Ù…Ø© ---
        const cleanStr = (str) => String(str || '').replace(/[\s\r\n\t]+/g, ' ').trim();
        const formatPrice = (p) => {
            if(!p) return '-';
            let num = parseFloat(String(p).replace(/[^0-9.]/g, ''));
            return isNaN(num) ? '-' : num.toLocaleString('en-US', {maximumFractionDigits:0});
        };

        // ==========================================
        // 1. Ø¥Ø¯Ø§Ø±Ø© Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (IndexedDB)
        // ==========================================
        
        // ÙØªØ­ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        function openDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open(DB_NAME, DB_VERSION);
                
                request.onupgradeneeded = (event) => {
                    const db = event.target.result;
                    if (!db.objectStoreNames.contains(STORE_NAME)) {
                        db.createObjectStore(STORE_NAME, { keyPath: "id", autoIncrement: true });
                    }
                    if (!db.objectStoreNames.contains("MetaData")) {
                        db.createObjectStore("MetaData", { keyPath: "key" });
                    }
                };

                request.onsuccess = (event) => resolve(event.target.result);
                request.onerror = (event) => reject(event.target.error);
            });
        }

        // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­
        async function saveDataToDB(data) {
            const db = await openDB();
            const tx = db.transaction([STORE_NAME, "MetaData"], "readwrite");
            
            // Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
            tx.objectStore(STORE_NAME).clear();
            tx.objectStore("MetaData").put({ key: "lastUpdated", date: new Date().toLocaleString('ar-IQ') });

            const store = tx.objectStore(STORE_NAME);
            data.forEach(item => store.add(item));

            return new Promise((resolve) => {
                tx.oncomplete = () => resolve();
            });
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ù…ØªØµÙØ­ Ø¹Ù†Ø¯ Ø§Ù„ÙØªØ­
        async function loadDataFromDB() {
            setStatus("Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©...", "blue");
            const db = await openDB();
            const tx = db.transaction([STORE_NAME, "MetaData"], "readonly");
            const store = tx.objectStore(STORE_NAME);
            const metaStore = tx.objectStore("MetaData");

            const request = store.getAll();
            const metaRequest = metaStore.get("lastUpdated");

            request.onsuccess = () => {
                if (request.result && request.result.length > 0) {
                    medicinesData = request.result;
                    // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø£ÙˆÙ„ Ø¹Ù†ØµØ± Ù„Ø¶Ù…Ø§Ù† Ø¹Ù…Ù„ Ø§Ù„Ø¨Ø­Ø«
                    if(medicinesData.length > 0) {
                        mapColumns(Object.keys(medicinesData[0]));
                    }
                    
                    metaRequest.onsuccess = () => {
                        const date = metaRequest.result ? metaRequest.result.date : "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";
                        document.getElementById('dbStatus').innerHTML = `âœ… Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§Øª Ø¬Ø§Ù‡Ø²Ø© (Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: ${date})`;
                        document.getElementById('dbStatus').style.color = "#15803d";
                        document.getElementById('dbStatus').style.background = "#dcfce7";
                        setStatus("", "");
                    };
                } else {
                    document.getElementById('dbStatus').innerText = "âš ï¸ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙØ§Ø±ØºØ©. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ø¯ÙŠØ«.";
                    setStatus("", "");
                }
            };
        }

        // Ù…Ø³Ø­ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        async function clearAllData() {
            if(!confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø²Ù†Ø©ØŸ")) return;
            const db = await openDB();
            const tx = db.transaction([STORE_NAME, "MetaData"], "readwrite");
            tx.objectStore(STORE_NAME).clear();
            tx.objectStore("MetaData").clear();
            
            tx.oncomplete = () => {
                medicinesData = [];
                document.getElementById('resultContainer').innerHTML = '';
                document.getElementById('dbStatus').innerText = "ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø°Ø§ÙƒØ±Ø©";
                clearInputs();
                alert("ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­");
            };
        }

        // ==========================================
        // 2. Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ù„ÙØ§Øª (Excel & GitHub)
        // ==========================================

        function handleFileUpload(input) {
            const file = input.files[0];
            if (!file) return;
            readFile(file);
        }

        async function loadFromGithub() {
            toggleLoader(true);
            try {
                const response = await fetch(GITHUB_URL);
                if (!response.ok) throw new Error("ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù");
                const buffer = await response.arrayBuffer();
                await processData(buffer);
                setStatus("ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« ÙˆØ§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­ âœ…", "green");
            } catch (e) { setStatus(e.message, "red"); } 
            finally { toggleLoader(false); }
        }

        function readFile(file) {
            toggleLoader(true);
            const reader = new FileReader();
            reader.onload = async (e) => {
                await processData(e.target.result);
                setStatus("ØªÙ… Ø§Ù„ØªØ­Ù…ÙŠÙ„ ÙˆØ§Ù„Ø­ÙØ¸ Ø¨Ù†Ø¬Ø§Ø­ âœ…", "green");
                toggleLoader(false);
            };
            reader.readAsArrayBuffer(file);
        }

        async function processData(buffer) {
            try {
                const wb = XLSX.read(new Uint8Array(buffer), { type: 'array' });
                const sheet = wb.Sheets[wb.SheetNames[0]];
                const raw = XLSX.utils.sheet_to_json(sheet);
                const headers = XLSX.utils.sheet_to_json(sheet, { header: 1 })[0];
                
                if (raw.length) {
                    medicinesData = raw;
                    mapColumns(headers);
                    await saveDataToDB(raw); // Ø§Ù„Ø­ÙØ¸ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
                    loadDataFromDB(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
                }
            } catch (e) { setStatus("Ø§Ù„Ù…Ù„Ù ØºÙŠØ± ØµØ§Ù„Ø­", "red"); console.error(e);}
        }

        function mapColumns(headers) {
            const norm = s => String(s).replace(/[\s\r\n\t]+/g, '').toLowerCase();
            const find = k => headers.find(h => h && k.some(x => norm(h).includes(norm(x))));
            
            columnMapping = {
                comm: find(['commercial', 'trade', 'Ø§Ù„Ù…Ø³ØªØ­Ø¶Ø±Ø§Ù„ØªØ¬Ø§Ø±ÙŠ', 'Ø§Ù„Ù…Ø³ØªØ­Ø±Ø¶']),
                sci: find(['scientific', 'Ø§Ù„Ù…Ø³ØªØ­Ø¶Ø±Ø§Ù„Ø¹Ù„Ù…ÙŠ']),
                comp: find(['company', 'Ø§Ù„Ø´Ø±ÙƒØ©']),
                phar: find(['pharmacy', 'Ø§Ù„Ù…Ø°Ø®Ø±Ù„Ù„ØµÙŠØ¯Ù„ÙŠØ©']),
                pub: find(['public', 'Ù…ÙˆØ§Ø·Ù†', 'Ø¬Ù…Ù‡ÙˆØ±'])
            };
        }

        // ==========================================
        // 3. Ù…Ø­Ø±Ùƒ Ø§Ù„Ø¨Ø­Ø« ÙˆØ§Ù„Ø¹Ø±Ø¶
        // ==========================================

        function handleSearch(type, query) {
            if (!medicinesData.length) return;
            const listId = type === 'commercial' ? 'listComm' : (type === 'scientific' ? 'listSci' : 'listComp');
            const listEl = document.getElementById(listId);
            
            document.querySelectorAll('.suggestions-list').forEach(el => {
                if(el.id !== listId) el.style.display = 'none';
            });

            if (query.length < 1) {
                listEl.style.display = 'none';
                return;
            }

            const q = query.toLowerCase();
            const keys = columnMapping;
            let matches = [];

            if (type === 'company') {
                const uniqueCompanies = new Set();
                medicinesData.forEach(item => {
                    const cName = cleanStr(item[keys.comp]);
                    if(cName) uniqueCompanies.add(cName);
                });
                matches = Array.from(uniqueCompanies).filter(c => c.toLowerCase().includes(q)).sort();
            } else {
                const keyToSearch = type === 'commercial' ? keys.comm : keys.sci;
                matches = medicinesData.filter(item => String(item[keyToSearch] || '').toLowerCase().includes(q));
            }

            renderSuggestions(type, matches.slice(0, 30), listEl);
        }

        function renderSuggestions(type, matches, container) {
            if (matches.length === 0) {
                container.style.display = 'none';
                return;
            }

            container.innerHTML = '';
            container.style.display = 'block';

            matches.forEach(item => {
                const div = document.createElement('div');
                div.className = 'suggestion-item';

                if (type === 'commercial') {
                    div.innerHTML = `<div class="sugg-main">${cleanStr(item[columnMapping.comm])}</div>`;
                    div.onclick = () => showDrugCard(item);
                } else if (type === 'scientific') {
                    div.innerHTML = `
                        <div class="sugg-main">${cleanStr(item[columnMapping.comm]) || 'Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù… ØªØ¬Ø§Ø±ÙŠ'}</div>
                        <div class="sugg-sub">${cleanStr(item[columnMapping.sci])}</div>
                    `;
                    div.onclick = () => showDrugCard(item);
                } else if (type === 'company') {
                    div.innerHTML = `<div class="sugg-main" style="color:#475569">${item}</div>`;
                    div.onclick = () => showCompanyProducts(item);
                }
                container.appendChild(div);
            });
        }

        function showDrugCard(item) {
            clearInputs();
            const keys = columnMapping;
            const container = document.getElementById('resultContainer');
            
            container.innerHTML = `
                <div class="drug-card">
                    <span class="company-badge">${cleanStr(item[keys.comp]) || 'Ø´Ø±ÙƒØ© ØºÙŠØ± Ù…Ø­Ø¯Ø¯Ø©'}</span>
                    <h2>${cleanStr(item[keys.comm]) || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}</h2>
                    <h3>${cleanStr(item[keys.sci]) || 'ØºÙŠØ± Ù…ØªÙˆÙØ±'}</h3>
                    <div class="prices-grid">
                        <div class="price-box price-phar">
                            <label>Ø³Ø¹Ø± Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ©</label>
                            <div class="value">${formatPrice(item[keys.phar])}</div>
                        </div>
                        <div class="price-box price-pub">
                            <label>Ø³Ø¹Ø± Ø§Ù„Ù…ÙˆØ§Ø·Ù†</label>
                            <div class="value">${formatPrice(item[keys.pub])}</div>
                        </div>
                    </div>
                </div>
            `;
        }

        function showCompanyProducts(companyName) {
            clearInputs();
            const keys = columnMapping;
            const container = document.getElementById('resultContainer');
            const products = medicinesData.filter(i => {
                const iComp = cleanStr(i[keys.comp]).toLowerCase();
                const qComp = companyName.toLowerCase();
                return iComp.includes(qComp) || qComp.includes(iComp);
            });

            let rows = products.map(item => `
                <tr onclick='showDrugCard(${JSON.stringify(item)})'>
                    <td>
                        <div style="font-weight:bold; color:#1e293b">${cleanStr(item[keys.comm])}</div>
                        <div style="font-size:0.85em; color:#64748b">${cleanStr(item[keys.sci])}</div>
                    </td>
                    <td style="color:var(--primary); direction:ltr; font-weight:bold;">${formatPrice(item[keys.phar])}</td>
                    <td style="color:#dc2626; direction:ltr; font-weight:bold;">${formatPrice(item[keys.pub])}</td>
                </tr>
            `).join('');

            container.innerHTML = `
                <div class="table-wrapper">
                    <div class="company-header">
                        <h3 style="margin:0; color:#1e293b">Ù…Ù†ØªØ¬Ø§Øª: <span style="color:var(--primary)">${companyName}</span></h3>
                        <span style="background:#e2e8f0; padding:5px 10px; border-radius:10px; font-size:0.85rem">${products.length} Ù…Ø§Ø¯Ø©</span>
                    </div>
                    <table>
                        <thead>
                            <tr><th style="text-align:right">Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ø¯Ø©</th><th>Ø³Ø¹Ø± Ø§Ù„ØµÙŠØ¯Ù„ÙŠØ©</th><th>Ø³Ø¹Ø± Ø§Ù„Ù…ÙˆØ§Ø·Ù†</th></tr>
                        </thead>
                        <tbody>${rows}</tbody>
                    </table>
                </div>
            `;
        }

        // --- ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù… ---
        function clearInputs() {
            document.querySelectorAll('input').forEach(i => i.value = '');
            document.querySelectorAll('.suggestions-list').forEach(l => l.style.display = 'none');
        }
        function toggleLoader(show) { document.getElementById('loader').style.display = show ? 'block' : 'none'; }
        function setStatus(msg, color) { const el = document.getElementById('statusMsg'); el.innerText = msg; el.style.color = color; }
        
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.input-wrapper')) document.querySelectorAll('.suggestions-list').forEach(l => l.style.display = 'none');
        });

        // ØªØ´ØºÙŠÙ„ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
        window.onload = loadDataFromDB;

    </script>
</body>
</html>
